<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì…ì› ê´€ë¦¬</title>
  <link rel="stylesheet" href="/css/inpatient.css">
</head>
<body>
  <div class="container">
    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar">
      <div class="profile">
        <div class="profile-icon">ğŸ‘¤</div>
        <div>
          <div class="profile-name">í™ê¸¸ë™</div>
          <div class="profile-role">ê°„í˜¸ì‚¬</div>
        </div>
      </div>
      <ul class="menu">
        <li>ì§„ë£Œ</li>
        <li>ì˜ˆì•½</li>
        <li>ìˆ˜ë‚©</li>
        <li>ì¬ê³ </li>
        <li class="active">ì…ì› â–¾
          <ul class="submenu">
            <li class="selected">ì…ì› ê´€ë¦¬</li>
            <li>ì…ì› í†µê³„</li>
          </ul>
        </li>
      </ul>
    </aside>

    <!-- ë³¸ë¬¸ -->
    <main class="main-content">
      <header class="page-header">
        <h1>ì…ì› ê´€ë¦¬</h1>
        <button id="addBtn" class="add-btn">+ í™˜ì ì…ì› ì¶”ê°€</button>
      </header>

      <!-- ë³‘ë™ íƒ­ -->
      <div class="ward-tabs" id="wardTabs"></div>

      <!-- ë³‘ì‹¤/í™˜ì ì¹´ë“œ ì˜ì—­ -->
      <div class="ward-board"></div>
    </main>
  </div>

  <script>
    // ë³‘ì‹¤ íƒ­ ë™ì  ìƒì„±
    function loadWardTabs() {
      fetch("/api/wards") // ë³‘ì‹¤ ëª©ë¡ API
        .then(res => res.json())
        .then(wards => {
          const tabContainer = document.getElementById("wardTabs");
          tabContainer.innerHTML = "";

          wards.forEach((wardName, index) => {
            const tab = document.createElement("button");
            tab.className = "tab";
            tab.innerText = wardName;
            if (index === 0) tab.classList.add("active");

            tab.addEventListener("click", () => {
              document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
              tab.classList.add("active");
              renderCards(wardName);
            });

            tabContainer.appendChild(tab);
          });

          if (wards.length > 0) {
            renderCards(wards[0]); // ì²« ë³‘ì‹¤ ê¸°ë³¸ ë¡œë”©
          }
        });
    }

    // ë³‘ì‹¤ë³„ ì…ì› í™˜ì ì¹´ë“œ ë Œë”ë§
    function renderCards(wardName) {
      const board = document.querySelector(".ward-board");
      board.innerHTML = "";

      fetch(`/Inpatient/admitted/${encodeURIComponent(wardName)}`)
        .then(res => res.json())
        .then(data => {
          if (data.length === 0) {
            board.innerHTML = "<p>ë“±ë¡ëœ í™˜ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
          }

          data.forEach(bed => {
            const card = document.createElement("div");
            card.className = "bed-card";

            const status = bed.patientType ?? "ë¯¸ì •";

            card.innerHTML = `
              <div class="bed-header">
                <span>${bed.room ?? "ë¯¸ì •"}</span>
                <span class="status ${status}">${status}</span>
              </div>
              <div class="patient-info">
                <p><strong>${bed.name}</strong> / ${bed.gender} / ${bed.age}ì„¸</p>
                <p>ì§„ë‹¨ëª…: ${bed.diagnosis ?? "ë¯¸ì •"}</p>
                <p>ì…ì›ì¼: ${bed.date ?? "ë¯¸ì •"}</p>
                <p>ë‹´ë‹¹ì˜: ${bed.doctor}</p>
              </div>
            `;

            card.addEventListener("click", () => {
			  const params = new URLSearchParams(bed);
			  if (bed.patientId) {
			    params.append("patientId", bed.patientId);
			  }
			  window.open(`/Inpatient/Popup?${params.toString()}`, 'í™˜ììƒì„¸', 'width=420,height=520');
			});


            board.appendChild(card);
          });
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadWardTabs();

      document.getElementById("addBtn").addEventListener("click", () => {
        window.open("/Inpatient/WaitingList", "ì…ì›ëŒ€ê¸° í™˜ì", "width=700,height=600");
      });
    });
  </script>
</body>
</html>
