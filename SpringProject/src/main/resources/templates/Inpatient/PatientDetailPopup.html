<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>환자 상세 정보</title>
  <link rel="stylesheet" href="/css/patientDetail.css">
</head>
<body>
<h2>환자 정보</h2>
<div class="form-area">

  <label>이름</label>
  <p th:text="${admission.patient.patientName}">이름</p>

  <label>성별 / 나이</label>
  <p>
    <span th:text="${admission.patient.patientGender}">성별</span> /
    <span th:text="${admission.patient.age}">나이</span>세
  </p>
<form th:action="@{/Inpatient/updateStatus}" method="post" id="statusForm">
  <label>진단명</label>
  <input type="text" id="symptomInput" name="symptom"
       th:value="${admission.patient.patientSymptom ?: '미정'}"
       disabled />

  <label>입원일</label>
  <p th:text="${#temporals.format(admission.admittedAt, 'yyyy-MM-dd')}">입원일</p>

  <label>담당의</label>
  <p th:text="${admission.doctor.usersName}">의사</p>
  

  <input type="hidden" name="patientId" th:value="${admission.patient.patientId}" />
  <label>상태</label>
  <select name="status" id="statusSelect" disabled>
   <!-- ✔ enum을 문자열로 바꿔서 비교 -->
	<option value="입원중" th:selected="${admission.patient.patientType.name() == '입원중'}">입원중</option>
	<option value="입원대기" th:selected="${admission.patient.patientType.name() == '입원대기'}">입원대기</option>
	<option value="퇴원" th:selected="${admission.patient.patientType.name() == '퇴원'}">퇴원</option>
  </select>
</form>

  
<div class="button-group">
  <button id="editBtn" class="edit" onclick="toggleEdit()">수정</button>

  <form th:action="@{/Inpatient/delete}" method="post" onsubmit="return confirm('정말 삭제하시겠습니까?');">
    <input type="hidden" name="patientId" th:value="${admission.patient.patientId}" />
    <button class="delete" type="submit">삭제</button>
  </form>

  <button class="cancel" onclick="window.close()">닫기</button>
</div>
</div>
</body>
<script>
  let isEditMode = false;

 function toggleEdit() {
  isEditMode = !isEditMode;

  const editBtn = document.getElementById("editBtn");
  const statusSelect = document.getElementById("statusSelect");

  statusSelect.disabled = !isEditMode;
// JavaScript 수정
if (isEditMode) {
	  editBtn.textContent = "저장";
	  editBtn.classList.remove("edit");
	  editBtn.classList.add("save");
	  statusSelect.disabled = false; 
	
	} else {
	  statusSelect.disabled = false; 
	  document.getElementById("statusForm").submit();
	}

}

</script>

</html>
