<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>진료 관리 화면</title>
<link rel="stylesheet" href="/css/hospital_style.css">
<link rel="stylesheet" href="/css/chart_style.css">
</head>
<body>
	<div class="hospital-container">

		<!-- 1) 사이드바 -->
		<aside class="hospital-sidebar">
			<h2 class="hospital-profile-title">
				<img th:src="@{/icons/profile.jpg}" alt="프로필"> <span
					th:text="${displayName}">의사 이름</span>
			</h2>
			<ul class="hospital-menu">
				<!-- 알림은 fetch로 부분 로딩 -->
				<li onclick="loadAndToggleNotification()"><img
					th:src="@{/icons/alert.png}" alt=""> 알림</li>
				<!-- 홈 -->
				<li><a th:href="@{/hospital/hospital_home}"> <img
						th:src="@{/icons/home.png}" alt=""> 홈
				</a></li>
				<!-- 진료 관리 -->
				<li><a th:href="@{/hospital/treatment}"> <img
						th:src="@{/icons/doctor.png}" alt=""> 진료
				</a></li>
				<!-- 예약 관리 -->
				<li><a th:href="@{/hospital/reservation}"> <img
						th:src="@{/icons/calendar.png}" alt=""> 예약
				</a></li>
				<!-- 차트 보기 -->
				<li><a th:href="@{/hospital/chart}"> <img
						th:src="@{/icons/chart.png}" alt=""> 차트
				</a></li>
				<!-- 통계 보기 -->
				<li><a th:href="@{/hospital/statistics}"> <img
						th:src="@{/icons/statistics.png}" alt=""> 통계
				</a></li>
			</ul>
			<div class="sidebar-footer">
				<button class="logout-btn" th:onclick="|location.href='@{/logout}'|">
					로그아웃</button>
			</div>
		</aside>


		<!-- 2) 환자 리스트 -->
		<section class="patient-list">
<<<<<<< HEAD
		  <h3>환자 리스트</h3>
		  <div class="status-label">대기 / 진행 중</div>
		
		  <!--  rooms 순회 -->
		  <div th:each="room : ${rooms}">
		    <details open class="room">
		      <summary>
		        <span th:text="${room}">진료실1</span>
		        <!-- 컨트롤러에서 계산해 준 값 -->
		        <span class="count" th:text="${countByRoom[room]}">0</span>
		      </summary>
		      <ul>
		        <li th:each="a : ${waitingByRoom[room]}">
		          <span th:text="${a.patient.patientName}">환자명</span>
		          <span class="badge waiting">대기</span>
		        </li>
		        <li th:each="a : ${inProgressByRoom[room]}">
		          <span th:text="${a.patient.patientName}">환자명</span>
		          <span class="badge in-progress">진행중</span>
		        </li>
		      </ul>
		    </details>
		  </div>
=======
			<!-- (A) 검색창 -->
			<div class="search">
				<input type="text" placeholder="환자 검색" id="patient-search-input">
			</div>

			<!-- (A-1) 검색 결과 패널 -->
			<div class="search-results" id="search-results"
				style="display: none;">
				<h4>환자 검색 결과</h4>
				
			</div>

			<!-- (B) 헤더 -->
			<h3>환자 리스트</h3>
			<div class="status-label">대기 / 진행 중</div>

			<!-- (C) 방별 카드들 -->
			<!-- 진료실1 -->
			<details open class="room">
				<summary>
					진료실 1 <span class="count">3</span><!-- 카운트 되게 만들기 -->
				</summary>
				
			</details>

			<!-- 진료실2 -->
			<details open class="room">
				<summary>
					진료실 2 <span class="count">2</span><!-- 카운트 되게 만들기 -->
				</summary>
			</details>
			
			<!-- 진료실3 -->
			<details open class="room">
				<summary>
					진료실 2 <span class="count">2</span><!-- 카운트 되게 만들기 -->
				</summary>
			</details>
			
			<!-- 진료실4 -->
			<details open class="room">
				<summary>
					진료실 2 <span class="count">2</span><!-- 카운트 되게 만들기 -->
				</summary>
			</details>
>>>>>>> branch 'main' of https://github.com/Jangton/2025_SpringProject.git
		</section>

		<!-- 3) 내원 이력 -->
		<section class="patient-history">
			<h3>내원 이력</h3>

			<!-- 첫 번째 방문 기록 -->
			<details open class="history-entry">
				<summary>
					<div class="history-date">2025-05-15 (오늘)</div>
					<div class="history-doctor">오진우 선생</div>
				</summary>
				<div class="history-content">
					<p>
						<strong>진단/소견:</strong> 두통, 발열
					</p>
					<p>
						<strong>처방 내역:</strong>
					</p>
					<ul>
						<li>해열진통제 500mg — 하루 3회</li>
						<li>진통제 시럽 5ml — 필요 시 추가</li>
					</ul>
				</div>
			</details>

			<!-- 두 번째 방문 기록 -->
			<details class="history-entry">
				<summary>
					<div class="history-date">2025-03-15 (두달 전)</div>
					<div class="history-doctor">이상민 선생</div>
				</summary>
				<div class="history-content">
					<p>
						<strong>진단/소견:</strong> 기침, 인후통
					</p>
					<p>
						<strong>처방 내역:</strong>
					</p>
					<ul>
						<li>기침약 10ml — 하루 2회</li>
						<li>가글액 — 식후 가글</li>
					</ul>
				</div>
			</details>
		</section>


		<!-- 4) 메인 진료 기록 -->
		<section class="col treatment-main">

			<!-- ─── 4-1) 헤더 ─── -->
			<div class="record-header">
				<div class="record-header-left">2021-09-01 (월) 10:00 ▶ 이은솔</div>
				<div class="record-header-right">
					<!-- 우측에 톱니바퀴 아이콘 등 -->
					<button class="icon-btn">⚙️</button>
				</div>
			</div>

			<!-- ─── 4-2) 본문 (증상 / 이미지) ─── -->
			<div class="record-notes">
				<h4>증상 기록</h4>
				<textarea placeholder="환자 증상 요약 내용을 입력하세요"></textarea>
				<button class="save-btn">저장</button>
			</div>


			<!-- ─── 4-3) 진단 및 처방 ─── -->
			<div class="record-prescription">
				<h4>진단 및 처방</h4>

				<!-- 도구 버튼 -->
				<div class="prescription-toolbar">
					<button>예방접종</button>
					<button>DUR점검</button>
					<button class="icon-btn">⚙️</button>
				</div>

				<!-- 검색창 ⬆️ 위로 이동 -->
				<div class="prescription-search">
					<input type="text" id="orderSearchInput"
						placeholder="오더 검색(ctrl+↑)">
					<div id="suggestions" class="suggestion-box"></div>
					<!-- 비워두기! -->

					<!-- 진단명 목록 ⬇️ 아래로 -->
					<div class="diagnosis-list" id="diagnosisList">
						<div class="diagnosis-items"></div>
					</div>

					<!-- 약품 테이블 -->
					<table class="prescription-table" id="prescriptionTable">
						<thead>
							<tr>
								<th>약품명</th>
								<th>용법/용량</th>
								<th>수량</th>
								<th>비고</th>
							</tr>
						</thead>
						<tbody id="prescriptionTbody">
							<!-- JS로 삽입 -->
						</tbody>
					</table>

					<!-- 버튼 -->
					<div class="prescription-action">
						<button id="manualAddBtn" class="add-prescription-btn">+
							수기처방 추가</button>
						<button class="send-btn">보내기 ▶</button>
					</div>
				</div>
		</section>
		<!-- 5) 환자 기록 메모 -->
		<aside class="col patient-record">
			<h3 class="record-title">📝 환자기록</h3>

			<ul class="record-timeline">
				<li><span class="tag yellow">김승환</span>
					<div class="record-time">09:03 AM</div>
					<div class="record-msg">
						발열증상 있으나 귀찮, 가족력: 당뇨 있음<br> <small>기록자: 간호사 박은하</small>
					</div></li>
				<li><span class="tag pink">이은솔</span>
					<div class="record-time">09:05 AM</div>
					<div class="record-msg">전진서 추가 부작용보고</div></li>
				<li><span class="tag gray">의료진</span>
					<div class="record-time">10:21 AM</div>
					<div class="record-msg">식사 직후 복약지시와 다음 방문 때 내과 검사 시행 예정</div></li>
			</ul>

			<form class="record-form">
				<textarea placeholder="기록할 내용을 입력하세요"></textarea>
				<button type="submit">올리기</button>
			</form>
		</aside>
		
	</div>
<<<<<<< HEAD
	<script>
=======
</body>
<script>
>>>>>>> branch 'main' of https://github.com/Jangton/2025_SpringProject.git
  function goToHome()        { location.href = '/home'; }
  function goToChart()       { location.href = '/hospital/chart'; }
  function goToReservation() { location.href = '/hospital/reservation'; }
  function goToTreatment()   { location.href = '/hospital/treatment'; }
  function goToStats()       { location.href = '/hospital/statistics'; }
  function goLogout()        { location.href = '/logout'; }

  const orderInput = document.getElementById('orderSearchInput');
  const suggestions = document.getElementById('suggestions');
  const diagnosisList = document.querySelector('.diagnosis-items');
  const tbody = document.getElementById('prescriptionTbody');

  let orderData = [];

  async function loadOrderData() {
  try {
    const diseaseRes = await fetch('/api/disease/list');
    const diseaseData = await diseaseRes.json();
    console.log("✅ diseaseData:", diseaseData); // 🔍 확인

    const drugRes = await fetch('/api/drug/list');
    const drugData = await drugRes.json();
    console.log("✅ drugData:", drugData); // 🔍 확인

    orderData = [
      ...diseaseData.map(d => ({
        type: 'disease',
        code: d.code,
        name: d.name,
        category: d.type
      })),
      ...drugData
    ];

    console.log("✅ orderData 최종:", orderData); // ✅ 여기 찍히는지 확인
  } catch (err) {
    console.error('❌ loadOrderData 실패:', err); // 오류가 여기 찍히는지!
  }
}

  // ✅ 2. 반드시 실행
  (async () => {
    await loadOrderData();
  })();

  // ✅ 3. 자동완성 이벤트 처리
  orderInput.addEventListener('input', () => {
    const query = orderInput.value.trim().toLowerCase();
    suggestions.innerHTML = '';

    if (!orderData || orderData.length === 0) {
      const div = document.createElement('div');
      div.innerHTML = '⏳ 데이터 로딩 중...';
      div.classList.add('suggestion-item');
      suggestions.appendChild(div);
      return;
    }

    const diseases = orderData.filter(item =>
      item.type === 'disease' && item.name.toLowerCase().includes(query)
    );
    const drugs = orderData.filter(item =>
      item.type === 'drug' && item.name.toLowerCase().includes(query)
    );

    // 진단명 그룹
    if (diseases.length > 0) {
      const diseaseLabel = document.createElement('div');
      diseaseLabel.textContent = '📁 진단명';
      diseaseLabel.classList.add('group-label');
      suggestions.appendChild(diseaseLabel);

      diseases.forEach(item => {
        const div = document.createElement('div');
        div.classList.add('suggestion-item');
        div.textContent = item.name;
        div.onclick = () => {
          const li = document.createElement('div');
          li.classList.add('diagnosis-item');
          li.innerHTML = `
            <span>${item.name}</span>
            <button class="delete-diagnosis-btn">❌</button>
          `;
          li.querySelector('.delete-diagnosis-btn').onclick = () => li.remove();
          diagnosisList.appendChild(li);
          orderInput.value = '';
          suggestions.innerHTML = '';
        };
        suggestions.appendChild(div);
      });
    }

    // 약물 그룹
    if (drugs.length > 0) {
      const drugLabel = document.createElement('div');
      drugLabel.textContent = '💊 약물';
      drugLabel.classList.add('group-label');
      suggestions.appendChild(drugLabel);

      drugs.forEach(item => {
        const div = document.createElement('div');
        div.classList.add('suggestion-item');
        div.textContent = item.name;
        div.onclick = () => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.name}</td>
            <td contenteditable="true">${item.dosage}</td>
            <td contenteditable="true">${item.count}</td>
            <td><button class="delete-btn">삭제</button></td>
          `;
          tbody.appendChild(tr);
          orderInput.value = '';
          suggestions.innerHTML = '';
        };
        suggestions.appendChild(div);
      });
    }
  });

  // 외부 클릭 시 자동완성 닫기
  document.addEventListener('click', e => {
    if (!suggestions.contains(e.target) && e.target !== orderInput) {
      suggestions.innerHTML = '';
    }
  });

  // 수기 처방 추가
  document.getElementById('manualAddBtn').addEventListener('click', () => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" placeholder="약품명" class="manual-input"></td>
      <td><input type="text" placeholder="용법/용량" class="manual-input"></td>
      <td><input type="number" placeholder="수량" class="manual-input" style="width: 60px;"></td>
      <td><button class="delete-btn">삭제</button></td>
    `;
    tbody.appendChild(tr);
  });

  // 처방 테이블 삭제 기능
  tbody.addEventListener('click', e => {
    if (e.target.classList.contains('delete-btn')) {
      const tr = e.target.closest('tr');
      if (tr) tr.remove();
    }
  });
</script>
<<<<<<< HEAD

</body>
=======
</script>
>>>>>>> branch 'main' of https://github.com/Jangton/2025_SpringProject.git
</html>
