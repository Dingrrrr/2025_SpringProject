<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>수납 홈</title>
<link rel="stylesheet" href="/css/AcceptanceHomestyle.css">

<style>

</style>
</head>
<body>
<!-- 사이드 바 -->
<div class = "sidebar">
	<div class = "profile">
		<div class = "profile-icon">👤</div>
		<span>내 프로필</span>
	</div>
	
	<div class = "menu-item">
		<div class = "menu-icon">🔔</div>
		<span>알림</span>
	</div>
	
	<div class = "menu-item">
		<div class = "menu-icon">🏠</div>
		<span>홈</span>
	</div>
	
	<div class="menu-item has-submenu" onclick="toggleSubMenu(this)">
		<div class = "menu-icon">📋</div>
		<span>진료</span>
	</div>
	<ul class="submenu">
	<a href="acceptanceDoctor">
   	 	<li class="submenu-item active">의사 스케줄</li></a>
   	 <a href ="acceptanceCondition">
    	<li class="submenu-item">진료 상태</li></a>

	</ul>
	
	<a href="acceptanceReception" class="menu-item">
	  <div class="menu-icon">👥</div>
	  <span>예약</span>
	</a>
	
	<div class = "menu-item">
		<div class = "menu-icon">✏️</div>
		<span>수납</span>
	</div>
	
	<div class = "menu-item">
		<div class = "menu-icon">💜</div>
		<span>재고</span>
	</div>
	
	<div class = "menu-item">
		<div class = "menu-icon">👥</div>
		<span>입원</span>
	</div>
</div>

<!-- 메인 -->
<div class="top-menu-bar">
    <!-- 왼쪽 영역: 예약 -->
    <div class="menu-section">
        <span class="menu-title">|예약</span>
        <button class="icon-btn btn-reset">🔄 초기화</button>
        <select class="dropdown">
            <option>11</option>
            <option>12</option>
        </select>
        <label class="label-text">내원접수</label>
    </div>

    <!-- 가운데 영역: 접수 -->
    <div class="menu-section reception-menu">
        <span class="menu-title">|접수</span>
        <button class="action-btn">+ 상담등록</button>
        <button class="action-btn">+ 하이패스 수납</button>
        <button class="alert-btn">🔴 내원취소</button>
    </div>

    <!-- 오른쪽 영역: 진료 -->
    <div class="menu-section treatment-menu">
        <span class="menu-title">|진료</span>
        <button class="icon-btn">👤 수납</button>
        <button class="icon-btn">📝 진료등록</button>
        <button class="icon-btn">✔️ 귀가처리</button>
        <button class="icon-btn">🔍 인쇄</button>
    </div>
</div>
<!-- 하단 영역 -->
<div class="content-wrapper">
    <!-- 1) 예약 영역 -->
    <div class="column reservation-column">
      <div class="header">
        <div class="search-bar">
          <input type="text" class="search-input" placeholder="환자 검색" />
          <button class="search-btn">검색</button>
        </div>
      </div>
        
   <!-- 예약현황  -->
    <div class="reservation-topbar">
        <!-- reservations.size() 를 이용해서 동적으로 개수 표시도 가능 -->
        <span class="reservation-title">
          예약현황(
		    <span th:if="${reservations != null}" th:text="${reservations.size()}">0</span>
		    <span th:if="${reservations == null}">0</span>
		  명)
        </span>
        <div class="reservation-actions">
          <button class="action-btn" onclick="openCustomerModal()">+ 환자 등록</button>
        </div>
      </div>
    
    <!-- 고객등록 모달 -->
<div id="customerModal" class="modal" style="display:none;">
  <div class="modal-content" style="width: 400px;">
    <span class="close-btn" onclick="closeCustomerModal()">×</span>
    <h3 style="margin-bottom: 15px;">환자 등록</h3>
    
    <form id="customerForm" method="post" action="/acceptance/acceptanceHome">
      <div style="margin-bottom: 10px;">
        <input type="text" placeholder="이름" name="patientName" required style="width: 100%; padding: 8px;">
      </div>
      <div style="margin-bottom: 10px;">
        <select name="patientGender" required style="width: 100%; padding: 8px;">
          <option value="">성별 선택</option>
          <option value="남">남</option>
          <option value="여">여</option>
        </select>
      </div>
		<div style="margin-bottom: 10px;">
		  <input type="text" name="patientBirth" placeholder="주민등록번호 (예: 900101-1234567)" required style="width: 100%; padding: 8px;">
		</div>
      <div style="margin-bottom: 10px;">
        <input type="tel" placeholder="전화번호 (예: 010-1234-5678)" name="patientPhone" required style="width: 100%; padding: 8px;">
      </div>
     <div style="margin-bottom: 10px;">
        <input type="tel" placeholder="증상" name="patientSymptom" required style="width: 100%; padding: 8px;">
      </div>    
      <div style="margin-bottom: 10px;">
        <select name="patientType" required style="width: 100%; padding: 8px;">
          <option value="진료대기">진료대기</option>
          <option value="입원대기">입원대기</option>
          <option value="입원중">입원중</option>
          <option value="진료중">진료중</option>
          <option value="퇴원">퇴원</option>
          <option value="예약">예약</option>
        </select>
      </div>
      <div style="margin-bottom: 15px;">
        <input type="text" placeholder="주소" name="patientAddress" required style="width: 100%; padding: 8px;">
      </div>
      <button type="submit" style="padding: 8px 12px; background-color: #3f78c5; color: white; border: none; border-radius: 4px; cursor: pointer;">
        등록
      </button>
    </form>
  </div>
</div>
    
    
	<!-- 예약 리스트 -->
		 <ul class="reservation-list">
        <li class="reservation-item"
            th:each="patient : ${reservations}">

          <!-- 예: patientBirth 필드를 “시간”처럼 보여주기 -->
          <span th:text="${patient.patientBirth.substring(0,7) + '*******'}"></span>

          <div class="info">
            <!-- ① 환자 이름과 전화번호를 한꺼번에 연결하려면 ${…} 안에서 모두 처리 -->
            <div class="name"
                 th:text="${patient.patientName + ' (' + patient.patientGender + ') ' + patient.patientPhone}">
              홍길동 (남) 010-1234-5678
            </div>

            <!-- ② 증상을 보여주려면 역시 ${…} 안에서 처리 -->
            <div class="details"
                 th:text="'증상: ' + ${patient.patientSymptom}">
              증상: 두통, 어지러움
            </div>
          </div>

        </li>
      </ul>
    </div>

    <!-- 접수 영역 -->
    <div class="column reception-column">
          <!-- 날짜 영역 -->
<div class="date-header">
    <!-- 1일 전으로 이동 -->
    <button class="nav-btn"
            th:onclick="|window.location='@{/acceptance/acceptanceHome(date=${targetDate.minusDays(1)})}'|">
      ◀
    </button>

    <!-- 현재 선택된 날짜(2025-06-02 월요일 등) 표시 -->
    <span class="date-text"
          th:text="${#temporals.format(targetDate, 'yyyy-MM-dd EEEE')}">
      2025-06-02 월요일
    </span>

    <!-- 1일 후로 이동 -->
    <button class="nav-btn"
            th:onclick="|window.location='@{/acceptance/acceptanceHome(date=${targetDate.plusDays(1)})}'|">
      ▶
    </button>

    <!-- 새로고침 (동일한 targetDate 다시 호출) -->
    <button class="nav-btn"
            th:onclick="|window.location='@{/acceptance/acceptanceHome(date=${targetDate})}'|">
      🔄 새로고침
    </button>
</div>

<!-- 날짜 선택 모달 -->
<div id="calendarModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">×</span>
    <h3>날짜 선택</h3>
    <input type="date" id="modalDatePicker">
    <button onclick="applyDate()">확인</button>
  </div>
</div>



  <!-- 접수현황 상단 바 -->
  <div class="reception-topbar">
    <span class="reception-title">
    	접수현황(
    	<span th:if="${appts != null}" th:text="${appts.size()}">0</span>
    	<span th:if="${appts == null}">0</span>
    	명)
    </span>
    <div class="filter-options">
      <label><input type="radio" name="filter" checked> 전체</label>
      <label><input type="radio" name="filter"> 예약</label>
      <label><input type="radio" name="filter"> 비예약</label>
    </div>
  </div>

  <!-- 접수 리스트 -->
  <ul class="reception-list">
    <li class="reception-item" th:each="appt : ${appts}">
      <div class="times">
        <span class="time1"
             th:text="${#temporals.format(appt.scheduledAt, 'HH:mm')} + ' 전'">
          13:00 전
        </span>
        <span class="time2"
              th:text="${#temporals.format(appt.createdAt,   'HH:mm')} + ' 내원'">
          09:16 내원
        </span>
      </div>
      <div class="info">
        <div class="name"
                 th:text="${ appt.patient.patientName 
                            + ' (' + appt.patient.patientGender + ') ' 
                            + appt.patient.patientPhone 
                            + ' [' + appt.patient.patientId + ']' }">
              전향애 (여) 010-7937-6626 [2]
            </div>
        <div class="details"
                 th:text="${ '증상: ' + appt.patient.patientSymptom 
                            + ' | 상태: ' + appt.patient.patientType }">
              증상: 호흡곤란 | 상태: 예약
            </div>
      </div>
    </li>
   </ul>

    </div>

    <!-- 진료 영역 -->
    <div class="column treatment-column">
         <!-- 상단 탭 -->
  <div class="treatment-tabs">
    <button class="tab-btn active">오늘통계</button>
    <button class="tab-btn">귀가</button>
  </div>
  
   <div class="treatment-tabs-option ">
      <select class="select-all">
      <option>전체선택</option>
      <option>선택해제</option>
    </select>
  </div>

  <!-- 수납/진료 현황 파란 바 -->
  <div class="treatment-status-bar">
    수납 [대기/완료] (0명/1명)<br>
    진료 [대기/중/완료] (0명/0명/0명)
  </div>

  <!-- 진료 리스트 -->
  <ul class="treatment-list">
    <li class="treatment-item">
      <div class="treatment-top">
        <div class="left-time">
          <span class="time-main">13:00 전</span>
          <span class="time-sub">09:16 수납완료</span>
        </div>
        <div class="patient-name">
          테테투스스(여) 010-1234-5678
        </div>
      </div>

      <div class="treatment-info">
        <div><strong>접수:</strong> 상담 성애네트웍스 / <strong>조진:</strong> 외국인상담</div>
        <div>[카드] 234,422원 [현금] 0원 [통장] 0원</div>
        <div>▶ 치료지시 ▶ 치료1 ///</div>
        <div>▶ 치료지시 ▶ 치료2 ///</div>
        <div>▶ 치료지시 ▶ 치료3, 부귀세 ///</div>
      </div>
    </li>
   </ul>

    </div>
</div>

<script>
// ───────────────────────────────────────────────────────
// 1) 메뉴 토글(사이드바 하위메뉴 열고 닫기)
// ───────────────────────────────────────────────────────
function toggleSubMenu(menuItem) {
  const allMenuItems = document.querySelectorAll('.menu-item');
  const allSubmenus  = document.querySelectorAll('.submenu');

  // 열린 상태라면 닫기
  const isActive = menuItem.classList.contains('active');
  allMenuItems.forEach(item => item.classList.remove('active'));
  allSubmenus.forEach(sub => sub.style.display = 'none');

  // 닫혀 있던 상태였다면 열기
  if (!isActive) {
    menuItem.classList.add('active');
    const submenu = menuItem.nextElementSibling;
    if (submenu && submenu.classList.contains('submenu')) {
      submenu.style.display = 'block';
    }
  }
}

document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.submenu-item').forEach(item => {
    item.addEventListener('click', () => {
      document.querySelectorAll('.submenu-item')
              .forEach(i => i.classList.remove('active'));
      item.classList.add('active');
    });
  });
});

// ───────────────────────────────────────────────────────
// 2) 날짜 표시 및 모달 제어
//    - currentDate: 전역에서 관리하는 “현재 선택된 날짜”
//    - formatDateString(): Date → "YYYY-MM-DD 요일" 형태 문자열 생성
//    - updateDateDisplay(): #currentDate 요소에 텍스트 반영
//    - open/close/applyDate(): 모달 열고 닫고 선택된 날짜 적용
//    - changeDate(diff): currentDate를 하루 전/후로 옮겨서 업데이트
// ───────────────────────────────────────────────────────
let currentDate = new Date();

function formatDateString(date) {
  const days = ['일요일','월요일','화요일','수요일','목요일','금요일','토요일'];
  const yyyy = date.getFullYear();
  const mm   = String(date.getMonth() + 1).padStart(2, '0');
  const dd   = String(date.getDate()).padStart(2, '0');
  const day  = days[date.getDay()];
  return `${yyyy}-${mm}-${dd} ${day}`;
}

function updateDateDisplay() {
  const el = document.getElementById('currentDate');
  if (el) {
    el.textContent = formatDateString(currentDate);
  }
}


// ───────────────────────────────────────────────────────
// 3) 환자 등록(고객등록) 모달 열기/닫기
// ───────────────────────────────────────────────────────
function openCustomerModal() {
  const modal = document.getElementById('customerModal');
  if (modal) modal.style.display = 'flex';
}

function closeCustomerModal() {
  const modal = document.getElementById('customerModal');
  if (modal) modal.style.display = 'none';
}

// ───────────────────────────────────────────────────────
// 4) DOMContentLoaded 이벤트에서 초기화할 작업들
//    - 메뉴 하위 메뉴를 클릭했을 때 ‘active’ 클래스를 토글
//    - 날짜 표시 초기화(updateDateDisplay())
//    - 환자등록 버튼에 클릭 이벤트 연결
// ───────────────────────────────────────────────────────
document.addEventListener('DOMContentLoaded', () => {
  // a) 메뉴 하위 메뉴 클릭 시 “active” 처리
  document.querySelectorAll('.submenu-item').forEach(item => {
    item.addEventListener('click', function () {
      document.querySelectorAll('.submenu-item').forEach(i => i.classList.remove('active'));
      this.classList.add('active');
    });
  });

  // b) 날짜 표시 초기화
  updateDateDisplay();

  // c) ‘고객 등록’(환자 등록) 버튼 연결
  const customerBtn = document.querySelector('.reservation-actions .action-btn');
  if (customerBtn) {
    customerBtn.addEventListener('click', openCustomerModal);
  }

  // d) 달력 모달 안의 확인/닫기 버튼 연결
  const applyBtn = document.querySelector('#calendarModal button');
  if (applyBtn) {
    applyBtn.addEventListener('click', applyDate);
  }
});

// ───────────────────────────────────────────────────────
// 5) 페이지 어딘가 다른 곳에서 사용할 수 있도록
//    전역 함수로 노출(release) – onclick 어트리뷰트에서 참조 가능
//    (예: <button onclick="openCalendar()">)  
// ───────────────────────────────────────────────────────
window.toggleSubMenu      = toggleSubMenu;
window.openCalendar       = openCalendar;
window.closeModal         = closeModal;
window.resetToday         = resetToday;
window.changeDate         = changeDate;
window.openCustomerModal  = openCustomerModal;
window.closeCustomerModal = closeCustomerModal;
</script>


</body>
</html>