<!DOCTYPE html>
<html lang = "ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì˜ì‚¬ ìŠ¤ì¼€ì¤„</title>
<link rel="stylesheet" href="/css/AcceptanceDoctorstyle.css">

<style>

</style>
</head>
<body>
<!-- ì‚¬ì´ë“œ ë°” -->
<div class = "sidebar">
	<div class = "profile">
		<div class = "profile-icon">ğŸ‘¤</div>
		<span th:text="${userName}">ìˆ˜ë‚© ì´ë¦„</span>
	</div>
	

	<a href = "/acceptance/acceptanceHome">
	<div class = "menu-item">
		<div class = "menu-icon">ğŸ </div>
		<span>í™ˆ</span>
	</div>
	</a>
	
	<div class="menu-item has-submenu" onclick="toggleSubMenu(this)">
		<div class = "menu-icon">ğŸ“‹</div>
		<span>ì§„ë£Œ</span>
	</div>
	
	<ul class="submenu">
	<a href="/acceptance/acceptanceDoctor">
   	 	<li class="submenu-item active">ì˜ì‚¬ ìŠ¤ì¼€ì¤„</li></a>
   	 <a href ="/acceptance/acceptanceCondition">
    	<li class="submenu-item">ì§„ë£Œ ìƒíƒœ</li></a>
	</ul>
	
	
	<a href="/acceptance/acceptanceReception" class="menu-item">
	  <div class="menu-icon">ğŸ‘¥</div>
	  <span>ì˜ˆì•½</span>
	</a>
	
	<a href = "/Drug/Drug">
	<div class = "menu-item">
		<div class = "menu-icon">ğŸ’œ</div>
		<span>ì¬ê³ </span>
		
	</div>
	</a>
	
	<div class="menu-item has-submenu" onclick="toggleSubMenu(this)">
  <div class="menu-icon">ğŸ›Œ</div>
  <span>ì…ì›</span>
</div>

<ul class="submenu">
  <a href="/Inpatient/Inpatient">
    <li class="submenu-item">ì…ì› ê´€ë¦¬</li>
  </a>
  <a href="/inpatient/InpatientStatistics">
    <li class="submenu-item">ì…ì› í†µê³„</li>
  </a>
</ul>

<a th:href="@{/Login/Logout}" class="menu-item logout">
    		<div class="menu-icon">ğŸšª</div>
    		<span>ë¡œê·¸ì•„ì›ƒ</span>
		</a>
    </div>
<div class="content">
<div class="schedule-header">
    <h2>ì˜ì‚¬ ìŠ¤ì¼€ì¤„</h2>
   <div class="header-right">
    <button id="resetSearch" title="ì´ˆê¸°í™”">ğŸ”„</button>
    <input type="text" id="doctorSearch" placeholder="ì˜ì‚¬ ì´ë¦„ ê²€ìƒ‰">
    <button onclick="searchDoctor()">ê²€ìƒ‰</button>
    <div class="month-navigator">
        <button onclick="changeMonth(-1)">â—€</button>
        <span id="month-title">2025ë…„ 6ì›”</span>
        <button onclick="changeMonth(1)">â–¶</button>
    </div>
</div>

</div>
    <div class="calendar">
        <div class="calendar-row calendar-header">
            <div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div>
        </div>
        <!-- JSê°€ ìƒì„±í•  ë‹¬ë ¥ -->
        <div id="calendar-body"></div>
    </div>
</div>

<script>
const dayOfWeekNames = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
let currentYear = 2025;
let currentMonth = 6;
let searchName = '';

// âœ… ìš”ì¼ ê¸°ì¤€ API í˜¸ì¶œ í•¨ìˆ˜
async function fetchDoctorsByDay(dayName) {
    const response = await fetch(`/acceptance/doctorScheduleByWeekday?day=${dayName}`);
    if (!response.ok) return [];
    return await response.json();
}

function getColorByName(name) {
    let hash = 0;
    for (let i = 0; i < name.length; i++) {
        hash = name.charCodeAt(i) + ((hash << 5) - hash);
    }
    const hue = hash % 360;
    return `hsl(${hue}, 70%, 80%)`;
}

function toggleSubMenu(el) {
  // â‘  ì„œë¸Œë©”ë‰´ê°€ ì•„ë‹ˆë¼, í´ë¦­ëœ ë©”ë‰´ ì•„ì´í…œ(el)ì— activeë¥¼ í† ê¸€
  el.classList.toggle('active');
}


// âœ… ë‹¬ë ¥ ìƒì„± í•¨ìˆ˜ (ë¹„ë™ê¸°)
async function generateCalendar(year, month) {
    const calendarBody = document.getElementById('calendar-body');
    calendarBody.innerHTML = '';

    const firstDay = new Date(year, month - 1, 1);
    const lastDate = new Date(year, month, 0).getDate();
    const startDayOfWeek = firstDay.getDay();
    const totalCells = Math.ceil((startDayOfWeek + lastDate) / 7) * 7;

    // âœ… ìš”ì¼ë³„ ì˜ì‚¬ ë¦¬ìŠ¤íŠ¸ í•œ ë²ˆì— ë‹¤ ë°›ì•„ì˜¤ê¸°
    const weekdayMap = {};
    for (let i = 0; i < 7; i++) {
        const dayName = dayOfWeekNames[i];
        weekdayMap[dayName] = await fetchDoctorsByDay(dayName); // { "ì›”": [...], "í™”": [...] }
    }

    let day = 1;
    for (let i = 0; i < totalCells / 7; i++) {
        const row = document.createElement('div');
        row.className = 'calendar-row';

        for (let j = 0; j < 7; j++) {
            const cell = document.createElement('div');
            cell.className = 'day-cell';
            const cellIndex = i * 7 + j;

            if (cellIndex >= startDayOfWeek && day <= lastDate) {
                const dateSpan = document.createElement('span');
                dateSpan.className = 'date';
                dateSpan.textContent = day;
                cell.appendChild(dateSpan);

                const dayName = dayOfWeekNames[j]; // "ì›”", "í™”" ë“±
                const doctors = weekdayMap[dayName] || [];

                for (let doc of doctors) {
                    if (!searchName || doc.usersId.includes(searchName)) {
                        const docDiv = document.createElement('div');
                        docDiv.className = 'doctor';
                        docDiv.textContent = doc.usersId;
                        docDiv.title = `${doc.startTime} ~ ${doc.endTime}`;
                        docDiv.style.backgroundColor = getColorByName(doc.usersId);
                        cell.appendChild(docDiv);
                    }
                }

                day++;
            }

            row.appendChild(cell);
        }

        calendarBody.appendChild(row);
    }
}

function updateMonthTitle(year, month) {
    document.getElementById('month-title').textContent = `${year}ë…„ ${month}ì›”`;
}

function changeMonth(offset) {
    currentMonth += offset;
    if (currentMonth < 1) {
        currentMonth = 12;
        currentYear--;
    } else if (currentMonth > 12) {
        currentMonth = 1;
        currentYear++;
    }
    updateMonthTitle(currentYear, currentMonth);
    generateCalendar(currentYear, currentMonth);
}

function searchDoctor() {
    const input = document.getElementById('doctorSearch').value.trim();
    searchName = input;
    generateCalendar(currentYear, currentMonth);
}

document.getElementById('resetSearch').addEventListener('click', function () {
    document.getElementById('doctorSearch').value = '';
    searchName = '';
    generateCalendar(currentYear, currentMonth);
});

document.addEventListener('DOMContentLoaded', function () {
    updateMonthTitle(currentYear, currentMonth);
    generateCalendar(currentYear, currentMonth);

    const submenuItems = document.querySelectorAll('.submenu-item');
    submenuItems.forEach(item => {
        item.addEventListener('click', function () {
            submenuItems.forEach(i => i.classList.remove('active'));
            item.classList.add('active');
        });
    });
});
</script>

</body>
</html>

