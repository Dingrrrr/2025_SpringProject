<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¬ê³  ê´€ë¦¬ - í†µí•© íŒ¨ë„</title>
  <link rel="stylesheet" href="/css/drug.css">
</head>
<body class="inventory">

  <!-- ì‚¬ì´ë“œë°” -->
  <div class="sidebar">
    <div class="profile">
      <div class="profile-icon">ğŸ‘¤</div>
      <div class="profile-text">ë‚´ í”„ë¡œí•„</div>
    </div>
    <div class="menu">
      <div class="menu-item active">ğŸ“¦ ì¬ê³ </div>
      <div class="submenu-item">ì…ê³ , ì¶œê³ </div>
    </div>
  </div>

  <!-- ë©”ì¸ ì½˜í…ì¸  -->
  <div class="inventory-main">
    <div class="header-bar">
      <div class="header-left">
        <input type="text" placeholder="ì´ë¦„, ë°”ì½”ë“œ, ì†ì„± ê²€ìƒ‰">
        <select><option>ì œí’ˆë³„</option></select>
        <select><option>ì´ë¦„ ì˜¤ë¦„ì°¨ìˆœ</option></select>
        <label><input type="checkbox"> ì¬ê³  ë³´ìœ </label>
      </div>
      <div class="header-right">
        <button onclick="window.open('/Drug/Add', 'AddDrugPopup', 'width=700,height=650')">+ ì œí’ˆ ì¶”ê°€</button>
        <button id="manage-btn" onclick="toggleEditMode()">âš™ ì œí’ˆ ê´€ë¦¬</button>
      </div>
    </div>

    <div class="content">
      <!-- ì™¼ìª½ íŒ¨ë„ -->
      <div class="panel">
        <div class="product-card" onclick="showDetail('í•˜íŠ¸ë§Œìˆ˜ì•¡')">
          <img class="thumb" src="https://via.placeholder.com/48" alt="í•˜íŠ¸ë§Œìˆ˜ì•¡">
          <div class="info-block">
            <div class="name">í•˜íŠ¸ë§Œìˆ˜ì•¡</div>
            <div class="info">ìˆ˜ì•¡ì œ | DDONE2</div>
          </div>
          <div class="stock">17</div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„ -->
      <div class="panel right-panel" id="detail-panel">
        <h2>ìƒì„¸ ì •ë³´</h2>
        <div class="placeholder">ì•½í’ˆì„ ì„ íƒí•˜ë©´ ì´ê³³ì— ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
      </div>
    </div>
  </div>

  <script>
    let isEditing = false;

    function showDetail(name) {
      if (name === 'í•˜íŠ¸ë§Œìˆ˜ì•¡') {
        const detailPanel = document.getElementById("detail-panel");
        const manageBtn = document.getElementById("manage-btn");
        if (manageBtn) {
          manageBtn.textContent = "âš™ ì œí’ˆ ê´€ë¦¬";
          isEditing = false;
        }

        detailPanel.innerHTML = `
          <div class="drug-info-card">
            <div class="title-row">
              <h2>í•˜íŠ¸ë§Œìˆ˜ì•¡</h2>
            </div>
            <div class="info-grid" id="drug-info">
              <div class="info-item"><label>ì¢…ë¥˜</label><div>ìˆ˜ì•¡ì œ</div></div>
              <div class="info-item"><label>ì•½í’ˆ ì½”ë“œ</label><div>DDONE2</div></div>
              <div class="info-item"><label>ë³´ê´€ ìœ„ì¹˜</label><div>ì°½ê³ -Aë°•ìŠ¤</div></div>
              <div class="info-item"><label>ì¬ê³ </label><div>17</div></div>
            </div>

            <div class="section-title">ì…ê³  ë‚´ì—­</div>
            <table>
              <tr><th>ì…ê³ ì¼</th><th>ìˆ˜ëŸ‰</th><th>ë¹„ê³ </th></tr>
              <tr><td>2025-05-01</td><td>10ê°œ</td><td>ìƒˆ ë°•ìŠ¤</td></tr>
              <tr><td>2025-04-18</td><td>7ê°œ</td><td>ë°˜í’ˆ ì…ê³ </td></tr>
            </table>

            <div class="section-title">ì¶œê³  ë‚´ì—­</div>
            <table>
              <tr><th>ì¶œê³ ì¼</th><th>ìˆ˜ëŸ‰</th><th>ì‚¬ìš©ì²˜</th></tr>
              <tr><td>2025-05-03</td><td>3ê°œ</td><td>ì…ì›í™˜ì A</td></tr>
              <tr><td>2025-05-06</td><td>2ê°œ</td><td>ì™¸ë˜ì§„ë£Œ</td></tr>
            </table>
          </div>
        `;
      }
    }

    function toggleEditMode() {
      const button = document.getElementById("manage-btn");

      if (!isEditing) {
        isEditing = true;
        enterEditModeFromManagement();
        button.textContent = "ğŸ’¾ ì œí’ˆ ì €ì¥";
      } else {
        saveDrugChanges();
        isEditing = false;
        button.textContent = "âš™ ì œí’ˆ ê´€ë¦¬";
      }
    }

    function enterEditModeFromManagement() {
      const detailPanel = document.getElementById("detail-panel");

      detailPanel.innerHTML = `
        <div class="drug-info-card">
          <div class="title-row">
            <h2>í•˜íŠ¸ë§Œìˆ˜ì•¡ ìˆ˜ì •</h2>
          </div>
          <div class="info-grid" id="drug-info-edit">
            <div class="info-item"><label>ì¢…ë¥˜</label><input type="text" value="ìˆ˜ì•¡ì œ" /></div>
            <div class="info-item"><label>ì•½í’ˆ ì½”ë“œ</label><input type="text" value="DDONE2" /></div>
            <div class="info-item"><label>ë³´ê´€ ìœ„ì¹˜</label><input type="text" value="ì°½ê³ -Aë°•ìŠ¤" /></div>
            <div class="info-item"><label>ì¬ê³ </label><input type="number" value="17" /></div>
          </div>

          <div class="section-title">ì…ê³  ë‚´ì—­</div>
          <table>
            <tr><th>ì…ê³ ì¼</th><th>ìˆ˜ëŸ‰</th><th>ë¹„ê³ </th></tr>
            <tr><td>2025-05-01</td><td>10ê°œ</td><td>ìƒˆ ë°•ìŠ¤</td></tr>
            <tr><td>2025-04-18</td><td>7ê°œ</td><td>ë°˜í’ˆ ì…ê³ </td></tr>
          </table>

          <div class="section-title">ì¶œê³  ë‚´ì—­</div>
          <table>
            <tr><th>ì¶œê³ ì¼</th><th>ìˆ˜ëŸ‰</th><th>ì‚¬ìš©ì²˜</th></tr>
            <tr><td>2025-05-03</td><td>3ê°œ</td><td>ì…ì›í™˜ì A</td></tr>
            <tr><td>2025-05-06</td><td>2ê°œ</td><td>ì™¸ë˜ì§„ë£Œ</td></tr>
          </table>
        </div>
      `;
    }

    function saveDrugChanges() {
      const inputs = document.querySelectorAll("#drug-info-edit input");
      const updated = {
        type: inputs[0].value,
        manufacturer: inputs[1].value,
        location: inputs[2].value,
        stock: inputs[3].value
      };

      alert("ìˆ˜ì •ëœ ë‚´ìš©:\n" + JSON.stringify(updated, null, 2));
      showDetail("í•˜íŠ¸ë§Œìˆ˜ì•¡");
    }

    window.addEventListener("message", function (event) {
      if (event.data.type === "ADD_DRUG") {
        const drug = event.data.payload;

        const panel = document.querySelector(".content .panel");
        const card = document.createElement("div");
        card.className = "product-card";
        card.onclick = () => showDetail(drug.name);

        card.innerHTML = `
          <img class="thumb" src="https://via.placeholder.com/48" alt="${drug.name}">
          <div class="info-block">
            <div class="name">${drug.name}</div>
            <div class="info">${drug.type} | ${drug.manufacturer}</div>
          </div>
          <div class="stock">${drug.stock}</div>
        `;

        panel.appendChild(card);
        alert(`'${drug.name}' ì•½í’ˆì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      }
    });
  </script>

</body>
</html>
