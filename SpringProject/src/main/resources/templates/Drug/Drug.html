<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>재고 관리 - 통합 패널</title>
  <link rel="stylesheet" href="/css/drug.css">
</head>
<body class="inventory">

  <!-- 사이드바 -->
  <div class="sidebar">
    <div class="profile">
      <div class="profile-icon">👤</div>
      <div class="profile-text">내 프로필</div>
    </div>
    <div class="menu">
      <div class="menu-item active">📦 재고</div>
      <div class="submenu-item">입고, 출고</div>
    </div>
  </div>

  <!-- 메인 콘텐츠 -->
  <div class="inventory-main">
    <div class="header-bar">
      <div class="header-left">
        <input type="text" placeholder="이름, 바코드, 속성 검색">
        <select><option>제품별</option></select>
        <select><option>이름 오름차순</option></select>
        <label><input type="checkbox"> 재고 보유</label>
      </div>
      <div class="header-right">
        <button onclick="window.open('/Drug/Add', 'AddDrugPopup', 'width=700,height=650')">+ 제품 추가</button>
        <button id="manage-btn" onclick="toggleEditMode()">⚙ 제품 관리</button>
      </div>
    </div>

    <div class="content">
      <!-- 왼쪽 패널 -->
      <div class="panel">
        <div class="product-card" onclick="showDetail('하트만수액')">
          <img class="thumb" src="https://via.placeholder.com/48" alt="하트만수액">
          <div class="info-block">
            <div class="name">하트만수액</div>
            <div class="info">수액제 | DDONE2</div>
          </div>
          <div class="stock">17</div>
        </div>
      </div>

      <!-- 오른쪽 패널 -->
      <div class="panel right-panel" id="detail-panel">
        <h2>상세 정보</h2>
        <div class="placeholder">약품을 선택하면 이곳에 상세 정보가 표시됩니다.</div>
      </div>
    </div>
  </div>

  <script>
    let isEditing = false;

    function showDetail(name) {
      if (name === '하트만수액') {
        const detailPanel = document.getElementById("detail-panel");
        const manageBtn = document.getElementById("manage-btn");
        if (manageBtn) {
          manageBtn.textContent = "⚙ 제품 관리";
          isEditing = false;
        }

        detailPanel.innerHTML = `
          <div class="drug-info-card">
            <div class="title-row">
              <h2>하트만수액</h2>
            </div>
            <div class="info-grid" id="drug-info">
              <div class="info-item"><label>종류</label><div>수액제</div></div>
              <div class="info-item"><label>약품 코드</label><div>DDONE2</div></div>
              <div class="info-item"><label>보관 위치</label><div>창고-A박스</div></div>
              <div class="info-item"><label>재고</label><div>17</div></div>
            </div>

            <div class="section-title">입고 내역</div>
            <table>
              <tr><th>입고일</th><th>수량</th><th>비고</th></tr>
              <tr><td>2025-05-01</td><td>10개</td><td>새 박스</td></tr>
              <tr><td>2025-04-18</td><td>7개</td><td>반품 입고</td></tr>
            </table>

            <div class="section-title">출고 내역</div>
            <table>
              <tr><th>출고일</th><th>수량</th><th>사용처</th></tr>
              <tr><td>2025-05-03</td><td>3개</td><td>입원환자 A</td></tr>
              <tr><td>2025-05-06</td><td>2개</td><td>외래진료</td></tr>
            </table>
          </div>
        `;
      }
    }

    function toggleEditMode() {
      const button = document.getElementById("manage-btn");

      if (!isEditing) {
        isEditing = true;
        enterEditModeFromManagement();
        button.textContent = "💾 제품 저장";
      } else {
        saveDrugChanges();
        isEditing = false;
        button.textContent = "⚙ 제품 관리";
      }
    }

    function enterEditModeFromManagement() {
      const detailPanel = document.getElementById("detail-panel");

      detailPanel.innerHTML = `
        <div class="drug-info-card">
          <div class="title-row">
            <h2>하트만수액 수정</h2>
          </div>
          <div class="info-grid" id="drug-info-edit">
            <div class="info-item"><label>종류</label><input type="text" value="수액제" /></div>
            <div class="info-item"><label>약품 코드</label><input type="text" value="DDONE2" /></div>
            <div class="info-item"><label>보관 위치</label><input type="text" value="창고-A박스" /></div>
            <div class="info-item"><label>재고</label><input type="number" value="17" /></div>
          </div>

          <div class="section-title">입고 내역</div>
          <table>
            <tr><th>입고일</th><th>수량</th><th>비고</th></tr>
            <tr><td>2025-05-01</td><td>10개</td><td>새 박스</td></tr>
            <tr><td>2025-04-18</td><td>7개</td><td>반품 입고</td></tr>
          </table>

          <div class="section-title">출고 내역</div>
          <table>
            <tr><th>출고일</th><th>수량</th><th>사용처</th></tr>
            <tr><td>2025-05-03</td><td>3개</td><td>입원환자 A</td></tr>
            <tr><td>2025-05-06</td><td>2개</td><td>외래진료</td></tr>
          </table>
        </div>
      `;
    }

    function saveDrugChanges() {
      const inputs = document.querySelectorAll("#drug-info-edit input");
      const updated = {
        type: inputs[0].value,
        manufacturer: inputs[1].value,
        location: inputs[2].value,
        stock: inputs[3].value
      };

      alert("수정된 내용:\n" + JSON.stringify(updated, null, 2));
      showDetail("하트만수액");
    }

    window.addEventListener("message", function (event) {
      if (event.data.type === "ADD_DRUG") {
        const drug = event.data.payload;

        const panel = document.querySelector(".content .panel");
        const card = document.createElement("div");
        card.className = "product-card";
        card.onclick = () => showDetail(drug.name);

        card.innerHTML = `
          <img class="thumb" src="https://via.placeholder.com/48" alt="${drug.name}">
          <div class="info-block">
            <div class="name">${drug.name}</div>
            <div class="info">${drug.type} | ${drug.manufacturer}</div>
          </div>
          <div class="stock">${drug.stock}</div>
        `;

        panel.appendChild(card);
        alert(`'${drug.name}' 약품이 추가되었습니다.`);
      }
    });
  </script>

</body>
</html>
